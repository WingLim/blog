<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Caddy V2 Webhook æ¨¡å— | Lim's Blog</title><link rel=stylesheet href=/sass/main.min.4e90cee935c47394b47f9cb7ffe8e3ffab18b88d82fea203918cc3f92eec5eb2.css></head><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>ğŸ˜</span>
Lim's Blog</a></div><div class=flex><a href=/articles/>Articles</a>
<button id=dark-mode-button></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Caddy V2 Webhook æ¨¡å—</h1><div class=post-meta><div>By on <time>May 08, 2021</time></div><div class=tags><a href=/tags/caddy/>Caddy</a>
<a href=/tags/module/>Module</a>
<a href=/tags/webhook/>Webhook</a></div></div></div></div></header></article><div class=article-post><h2 id=ä»‹ç»>ä»‹ç»</h2><p>é¡¹ç›®åœ°å€ï¼š<a href=https://github.com/WingLim/caddy-webhook>caddy-webhook</a></p><p><code>caddy-webhook</code> çš„æµç¨‹åˆ†ä¸‰æ­¥ï¼š</p><ol><li>åˆå§‹åŒ–æ—¶æ‹‰å–ä»“åº“åˆ°æŒ‡å®šçš„æœ¬åœ°è·¯å¾„ï¼Œå¦‚æœæœ¬åœ°è·¯å¾„ä¸Šå·²ç»å­˜åœ¨ä»“åº“ï¼Œåˆ™ç”¨ <code>fetch</code> æ›´æ–°å¹¶åˆ‡æ¢åˆ°è®¾å®šçš„åˆ†æ”¯ã€‚</li><li>åœ¨ä»“åº“å†…æ‰§è¡Œç”¨æˆ·è®¾å®šçš„å‘½ä»¤ã€‚</li><li>åœ¨ç”¨æˆ·è®¾å®šçš„ç½‘å€è·¯å¾„ä¸Šç›‘å¬ webhook è¯·æ±‚ï¼Œæ”¶åˆ°æ­£ç¡®çš„è¯·æ±‚åæ›´æ–°ä»“åº“å¹¶é‡å¤ç¬¬2æ­¥ã€‚</li></ol><h2 id=ä½¿ç”¨æ–¹æ³•>ä½¿ç”¨æ–¹æ³•</h2><p>ç°åœ¨æ”¯æŒçš„ webhook ç±»å‹ï¼š</p><ul><li>github</li><li>gitlanb</li><li>gitee</li><li>bitbucket</li><li>gogs</li></ul><h3 id=caddyfile-æ ¼å¼>Caddyfile æ ¼å¼</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ª <code>route</code> ä¸­æœ‰å¤šä¸ª handleï¼Œwebhook è¿™ä¸ª handler éœ€è¦æ”¾åœ¨æœ€åï¼Œå› ä¸ºä¸ºäº†æ­£ç¡®å“åº” webhook requestï¼Œ<code>caddy-webhook</code> ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ª handlerã€‚</p><p>è¿™é‡Œå»ºè®®å•ç‹¬ç»™ webhook è®¾ç½®ä¸€ä¸ªè·¯å¾„ã€‚</p><pre><code>webhook [&lt;repo&gt; &lt;path&gt;] {
    repo       &lt;text&gt;
    path       &lt;text&gt;
    branch     &lt;text&gt;
    depth      &lt;int&gt;
    type       &lt;text&gt;
    secret     &lt;text&gt;
    command    &lt;text&gt;...
    key	       &lt;text&gt;
    username   &lt;text&gt;
    password   &lt;text&gt;
    token      &lt;text&gt;
    submodule
}
</code></pre><ul><li>repo - git ä»“åº“çš„è¿œç¨‹åœ°å€ï¼Œæ”¯æŒ httpã€httpsã€ssh</li><li>path - git ä»“åº“çš„æœ¬åœ°è·¯å¾„</li><li>branch - åˆ†æ”¯å</li><li>depth - æ‹‰å–æ—¶çš„æ·±åº¦ã€‚é»˜è®¤å€¼ä¸º <code>0</code></li><li>type - webhook çš„ç±»å‹ã€‚é»˜è®¤å€¼ä¸º <code>github</code></li><li>secret - ç”¨æˆ·åœ¨ GitHub ç­‰ç½‘ç«™ä¸Šè®¾ç½®çš„è¯·æ±‚çš„å¯†ç ï¼Œç”¨äºæ ¡éªŒè¯·æ±‚</li><li>submodule - æ˜¯å¦åŠ è½½å­æ¨¡å—</li><li>command - è¦æ‰§è¡Œçš„å‘½ä»¤</li><li>key - ä½¿ç”¨ ssh æ–¹æ³•è·å– git ä»“åº“æ—¶éœ€è¦çš„ key æ–‡ä»¶è·¯å¾„</li><li>username - http è®¤è¯çš„ç”¨æˆ·å</li><li>password - http è®¤è¯çš„å¯†ç </li><li>token - GitHub æˆæƒ Token</li></ul><h2 id=ä½¿ç”¨æ ·ä¾‹>ä½¿ç”¨æ ·ä¾‹</h2><p><code>Caddyfile</code></p><pre><code>example.com

root www
file_server

route /webhook {
    webhook {
        repo https://github.com/WingLim/winglim.github.io.git
        path blog
        branch hugo
        command hugo --destination ../www
        submodule   
    }
}
</code></pre></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/post/build-docker-image-in-multi-archs-with-github-actions/ title="Previous post (older)"><span>Previous</span>
ä½¿ç”¨GiHub Actionsæ„å»ºå¤šæ¶æ„Dockeré•œåƒ</a></nav></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a></nav></section><script async src=/js/features.min.a94f58a30ad2560de728e080d87f75c60cf806fd1b3d5f4815f1a1a02c0d1859.js></script></footer></body></html>